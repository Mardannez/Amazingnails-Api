generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model booking {
  id          String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  service_id  String         @db.Uuid
  staff_id    String         @db.Uuid
  customer_id String         @db.Uuid
  start_at    DateTime       @db.Timestamptz(6)
  end_at      DateTime       @db.Timestamptz(6)
  status      booking_status @default(CONFIRMED)
  notes       String?
  created_at  DateTime       @default(now()) @db.Timestamptz(6)
  customer    customer       @relation(fields: [customer_id], references: [id], onUpdate: NoAction)
  service     service        @relation(fields: [service_id], references: [id], onUpdate: NoAction)
  staff       staff          @relation(fields: [staff_id], references: [id], onUpdate: NoAction)

  @@unique([staff_id, start_at], map: "uq_booking_staff_start")
  @@index([customer_id], map: "idx_booking_customer")
  @@index([service_id, start_at], map: "idx_booking_service_start")
  @@index([staff_id, start_at], map: "idx_booking_staff_start")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model customer {
  id         String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  full_name  String
  phone      String?
  email      String?
  created_at DateTime   @default(now()) @db.Timestamptz(6)
  booking    booking[]
  booking2   booking2[] @relation("booking2_customer")

  @@index([email], map: "idx_customer_email")
  @@index([phone], map: "idx_customer_phone")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model service {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String
  duration_min Int
  price        Decimal?   @db.Decimal(10, 2)
  is_active    Boolean    @default(true)
  created_at   DateTime   @default(now()) @db.Timestamptz(6)
  description  String?
  booking      booking[]
  booking2     booking2[] @relation("booking2_service")
}

model staff {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String
  is_active     Boolean         @default(true)
  booking       booking[]
  booking2      booking2[]      @relation("booking2_staff")
  time_off      time_off[]
  working_hours working_hours[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model time_off {
  id       String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  staff_id String   @db.Uuid
  start_at DateTime @db.Timestamptz(6)
  end_at   DateTime @db.Timestamptz(6)
  reason   String?
  staff    staff    @relation(fields: [staff_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([staff_id, start_at], map: "idx_time_off_staff_start")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model working_hours {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  staff_id    String   @db.Uuid
  day_of_week Int      @db.SmallInt
  start_time  DateTime @db.Time(6)
  end_time    DateTime @db.Time(6)
  staff       staff    @relation(fields: [staff_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([staff_id, day_of_week, start_time, end_time], map: "uq_working_hours_staff_day")
}

model booking2 {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  service_id   String         @db.Uuid
  staff_id     String         @db.Uuid
  customer_id  String         @db.Uuid
  booking_date DateTime       @db.Date
  start_min    Int            @db.SmallInt
  duration_min Int            @db.SmallInt
  status       booking_status @default(CONFIRMED)
  notes        String?
  created_at   DateTime       @default(now()) @db.Timestamptz(6)
  customer     customer       @relation("booking2_customer", fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  service      service        @relation("booking2_service", fields: [service_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  staff        staff          @relation("booking2_staff", fields: [staff_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([staff_id, booking_date], map: "idx_booking2_staff_date")
  @@index([staff_id, booking_date, start_min], map: "idx_booking2_staff_date_start")
}

enum booking_status {
  PENDING
  CONFIRMED
  CANCELLED
}
